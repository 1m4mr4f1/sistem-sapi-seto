generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  // PERHATIKAN: Tidak ada tulisan 'env' di baris bawah ini
  url      = "mysql://root:root@localhost:3306/db_sistem_sapi_seto"
}

enum PaymentStatus {
  paid
  unpaid
}

model User {
  id             BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  name           String   @db.VarChar(100)
  username       String   @unique @db.VarChar(50)
  password       String   @db.VarChar(255)
  role           String   @default("cashier") @db.VarChar(20)
  remember_token String?  @db.VarChar(100)
  created_at     DateTime @default(now()) @db.Timestamp(0)
  updated_at     DateTime @updatedAt @db.Timestamp(0)

  sales     Sale[]
  purchases Purchase[]
  expenses  Expense[]

  @@map("users")
}

model Product {
  id                  BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  product_name        String   @db.VarChar(150)
  stock               Int      @default(0)
  selling_price       Decimal  @db.Decimal(10, 2)
  last_purchase_price Decimal? @db.Decimal(10, 2)
  created_at          DateTime @default(now()) @db.Timestamp(0)
  updated_at          DateTime @updatedAt @db.Timestamp(0)

  sale_details     SaleDetail[]
  purchase_details PurchaseDetail[]

  @@map("products")
}

model Supplier {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  supplier_name String   @db.VarChar(100)
  contact       String?  @db.VarChar(100)
  created_at    DateTime @default(now()) @db.Timestamp(0)
  updated_at    DateTime @updatedAt @db.Timestamp(0)

  purchases Purchase[]

  @@map("suppliers")
}

model Customer {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  customer_name String   @db.VarChar(100)
  contact       String?  @db.VarChar(100)
  created_at    DateTime @default(now()) @db.Timestamp(0)
  updated_at    DateTime @updatedAt @db.Timestamp(0)

  sales Sale[]

  @@map("customers")
}

model Sale {
  id             BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  user_id        BigInt        @db.UnsignedBigInt
  customer_id    BigInt?       @db.UnsignedBigInt
  sale_date      DateTime      @db.DateTime(0)
  subtotal       Decimal       @db.Decimal(10, 2)
  discount       Decimal       @default(0.00) @db.Decimal(10, 2)
  final_total    Decimal       @db.Decimal(10, 2)
  payment_status PaymentStatus
  note           String?       @db.Text
  created_at     DateTime      @default(now()) @db.Timestamp(0)
  updated_at     DateTime      @updatedAt @db.Timestamp(0)

  user     User      @relation(fields: [user_id], references: [id])
  customer Customer? @relation(fields: [customer_id], references: [id], onDelete: SetNull)

  sale_details       SaleDetail[]
  payment_receivables PaymentReceivable[]

  @@map("sales")
}

model Purchase {
  id             BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  user_id        BigInt        @db.UnsignedBigInt
  supplier_id    BigInt        @db.UnsignedBigInt
  purchase_date  DateTime      @db.DateTime(0)
  total_purchase Decimal       @db.Decimal(10, 2)
  payment_status PaymentStatus
  note           String?       @db.Text
  created_at     DateTime      @default(now()) @db.Timestamp(0)
  updated_at     DateTime      @updatedAt @db.Timestamp(0)

  user     User     @relation(fields: [user_id], references: [id])
  supplier Supplier @relation(fields: [supplier_id], references: [id])

  purchase_details PurchaseDetail[]
  payment_payables PaymentPayable[]

  @@map("purchases")
}

model Expense {
  id           BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  user_id      BigInt   @db.UnsignedBigInt
  expense_date DateTime @db.Date
  expense_type String   @db.VarChar(50)
  amount       Decimal  @db.Decimal(10, 2)
  description  String?  @db.Text
  created_at   DateTime @default(now()) @db.Timestamp(0)
  updated_at   DateTime @updatedAt @db.Timestamp(0)

  user User @relation(fields: [user_id], references: [id])

  @@map("expenses")
}

model SaleDetail {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  sale_id       BigInt   @db.UnsignedBigInt
  product_id    BigInt?  @db.UnsignedBigInt
  quantity      Int
  price_at_sale Decimal  @db.Decimal(10, 2)
  created_at    DateTime @default(now()) @db.Timestamp(0)
  updated_at    DateTime @updatedAt @db.Timestamp(0)

  sale    Sale     @relation(fields: [sale_id], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [product_id], references: [id], onDelete: SetNull)

  @@map("sale_details")
}

model PurchaseDetail {
  id                BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  purchase_id       BigInt   @db.UnsignedBigInt
  product_id        BigInt?  @db.UnsignedBigInt
  quantity          Int
  price_at_purchase Decimal  @db.Decimal(10, 2)
  created_at        DateTime @default(now()) @db.Timestamp(0)
  updated_at        DateTime @updatedAt @db.Timestamp(0)

  purchase Purchase @relation(fields: [purchase_id], references: [id], onDelete: Cascade)
  product  Product? @relation(fields: [product_id], references: [id], onDelete: SetNull)

  @@map("purchase_details")
}

model PaymentReceivable {
  id           BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  sale_id      BigInt   @db.UnsignedBigInt
  payment_date DateTime @db.Date
  amount_paid  Decimal  @db.Decimal(10, 2)
  created_at   DateTime @default(now()) @db.Timestamp(0)
  updated_at   DateTime @updatedAt @db.Timestamp(0)

  sale Sale @relation(fields: [sale_id], references: [id], onDelete: Cascade)

  @@map("payments_receivable")
}

model PaymentPayable {
  id           BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  purchase_id  BigInt   @db.UnsignedBigInt
  payment_date DateTime @db.Date
  amount_paid  Decimal  @db.Decimal(10, 2)
  created_at   DateTime @default(now()) @db.Timestamp(0)
  updated_at   DateTime @updatedAt @db.Timestamp(0)

  purchase Purchase @relation(fields: [purchase_id], references: [id], onDelete: Cascade)

  @@map("payments_payable")
}